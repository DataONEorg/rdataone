<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Updating Packages on DataONE â€¢ dataone</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Updating Packages on DataONE">
<meta property="og:description" content="dataone">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataone</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dataone-federation.html">DataONE Federation</a>
    </li>
    <li>
      <a href="../articles/dataone-overview.html">dataone R Package Overview</a>
    </li>
    <li>
      <a href="../articles/download-data.html">Downloading Data From DataONE</a>
    </li>
    <li>
      <a href="../articles/known-issues.html">Known Issues</a>
    </li>
    <li>
      <a href="../articles/searching-dataone.html">Searching DataONE Data Holdings</a>
    </li>
    <li>
      <a href="../articles/update-package.html">Updating Packages on DataONE</a>
    </li>
    <li>
      <a href="../articles/upload-data.html">Uploading Data to DataONE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DataONEorg/rdataone/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Updating Packages on DataONE</h1>
            
            <h4 class="date">2020-06-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DataONEorg/rdataone/blob/master/vignettes/update-package.Rmd"><code>vignettes/update-package.Rmd</code></a></small>
      <div class="hidden name"><code>update-package.Rmd</code></div>

    </div>

    
    
<div id="updating-a-dataone-package" class="section level2">
<h2 class="hasAnchor">
<a href="#updating-a-dataone-package" class="anchor"></a>Updating A DataONE Package</h2>
<p>A DataONE package is a collection of datasets and other files that are described by a metadata file.</p>
<p>A <em>DataPackage</em> is a <code>dataone</code> R object that can contain a DataONE package that is either downloaded from DataONE or newly created locally in R and then uploaded to DataONE.</p>
<p>After a package has been uploaded to a DataONE Member Node, it may be determined by the package submitter or other interested parties that the package needs to be updated, for example to add a missing file, replace one file with another, or remove a package member from the package.</p>
<p>These types of modifications can be accomplished by downloading the package from DataONE using the <code>getDataPackage</code> method to create a local copy of the package in R, modifying the package contents locally, then uploading the modified package to DataONE.</p>
<p>The complete example script used to perform a package update is shown below:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">datapack</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dataone</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">d1c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/D1Client.html">D1Client</a></span>(<span class="st">"STAGING"</span>, <span class="st">"urn:node:mnStageUCSB2"</span>)
<span class="no">packageId</span> <span class="kw">&lt;-</span> <span class="st">"resource_map_urn:uuid:a9aeefcf-228c-4534-b4ad-b480a937be7d"</span></pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/getDataPackage.html">getDataPackage</a></span>(<span class="no">d1c</span>, <span class="kw">identifier</span><span class="kw">=</span><span class="no">packageId</span>, <span class="kw">lazyLoad</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">limit</span><span class="kw">=</span><span class="st">"0MB"</span>, <span class="kw">quiet</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">metadataId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@formatId"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>)
<span class="no">objId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@fileName"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">'Strix-occidentalis-obs.csv'</span>)
<span class="no">zipfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Strix-occidentalis-obs.csv.zip"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"dataone"</span>)
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/replaceMember.html">replaceMember</a></span>(<span class="no">pkg</span>, <span class="no">objId</span>, <span class="kw">replacement</span><span class="kw">=</span><span class="no">zipfile</span>, <span class="kw">formatId</span><span class="kw">=</span><span class="st">"application/octet-stream"</span>)
<span class="no">auxFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/WeatherInf.txt"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"dataone"</span>)
<span class="no">auxObj</span> <span class="kw">&lt;-</span> <span class="fu">new</span>(<span class="st">"DataObject"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"text/plain"</span>, <span class="kw">filename</span><span class="kw">=</span><span class="no">auxFile</span>)
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/addMember.html">addMember</a></span>(<span class="no">pkg</span>, <span class="no">auxObj</span>, <span class="no">metadataId</span>)</pre></body></html></div>
<!-- Need authentication, so can't upload from a vignette. -->
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">newPackageId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/uploadDataPackage.html">uploadDataPackage</a></span>(<span class="no">d1c</span>, <span class="no">pkg</span>, <span class="kw">public</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">quiet</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p>This example script downloads the example package that was created and uploaded to DataONE in the vignette <code>upload-data</code>.</p>
<p>Each line of this script will be described in the following sections.</p>
<div id="download-the-package-from-dataone" class="section level3">
<h3 class="hasAnchor">
<a href="#download-the-package-from-dataone" class="anchor"></a>1. Download the package from DataONE</h3>
<p>The first step in updating a package is to download the package from DataONE into R, so that it can be modified locally using methods in the <code>dataone</code> package. Modifications can be made to the package such as adding or removing members from the package, or changing the contents of a package member, as would be the case if the wrong file was initially uploaded.</p>
<p>The <code>getDataPackage</code> method downloads all files belonging to the package specified by the <code>identifier</code> parameter.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">d1c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/D1Client.html">D1Client</a></span>(<span class="st">"STAGING"</span>, <span class="st">"urn:node:mnStageUCSB2"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/getDataPackage.html">getDataPackage</a></span>(<span class="no">d1c</span>, <span class="kw">identifier</span><span class="kw">=</span><span class="no">packageId</span>, <span class="kw">lazyLoad</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">limit</span><span class="kw">=</span><span class="st">"0MB"</span>, <span class="kw">quiet</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p>Because packages might contain large files or a large number of files, it is possible to <code>lazyLoad</code> the package. This means that the metadata describing the files is downloaded downloaded, but the file contents, the data bytes, are not. An upper size limit can be specified when using <code>lazyLoad</code> by also specifying the <code>limit</code> parameter. Files that are larger than the <code>limit</code> value are not downloaded, only system metadata.</p>
<p>For the package update that will be shown, it is not necessary to download the data bytes of each package member, so <code>lazyLoading</code> is acceptable. An example when lazyloading would not be appropriate is when the files in a package will be used for local computational processing.</p>
<p>Note that metadata files, such as the EML in this example, are always downloaded regardless of the <code>lazyLoad</code> parameter value.</p>
</div>
<div id="review-package-contents-" class="section level3">
<h3 class="hasAnchor">
<a href="#review-package-contents-" class="anchor"></a>2. Review package contents.</h3>
<p>The downloaded package can be viewed by typing the DataPackage object name at the console, which invokes the R <code>show</code> method for the object:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">pkg</span></pre></body></html></div>
<p>Note that the <code>show</code> output for a DataPackage is condensed to fit the width of the current R console. If the output is condensed and more detail is required, set the R console width to a larger value, for example, <code><a href="https://rdrr.io/r/base/options.html">options(width=120)</a></code>, or if using <code>Rstudio</code>, widen the console window by clicking and dragging on the window boarder.</p>
</div>
<div id="modify-dataobjects-in-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#modify-dataobjects-in-the-package" class="anchor"></a>3. Modify DataObjects in the package</h3>
<p>The original uploaded package included the file <code>Strix-occidentalis-obs.csv</code>. This file can be substituted for a different file, as would be necessary if it was determined that the zipped form of the file should have been used instead.</p>
<p>First, determine which DataObject in the DataPackage <code>pkg</code> contains the file to be replaced:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">objId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@fileName"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">'Strix-occidentalis-obs.csv'</span>)</pre></body></html></div>
<p>The <code>selectMember</code> method inspects every DataObject in the package <code>pkg</code> and checks for a match in the R S4 slot specified by the <code>name</code> argument for the value specified with the <code>value</code> argument. The identifier for any matching DataObject is returned.</p>
<p>The documentation for the DataObject R slots available can be viewed with the command <code><a href="https://rdrr.io/pkg/datapack/man/DataObject-class.html">help("DataObject-class")</a></code>. As a <em>SystemMetadata</em> object is contained in each DataObject, the slots for SystemMetadata are available, with documentation viewable with <code><a href="https://rdrr.io/pkg/datapack/man/SystemMetadata-class.html">help("SystemMetadata-class")</a></code></p>
<p>Next, update the DataObject in <code>pkg</code> to replace the file <code>Strix-occidentalis-obs.csv</code> with <code>Strix-occidentalis-obs.csv.zip</code> using the <code>replaceMember</code> method:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">objId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@fileName"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">'Strix-occidentalis-obs.csv'</span>)
<span class="no">zipfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Strix-occidentalis-obs.csv.zip"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"dataone"</span>)
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/replaceMember.html">replaceMember</a></span>(<span class="no">pkg</span>, <span class="no">objId</span>, <span class="kw">replacement</span><span class="kw">=</span><span class="no">zipfile</span>, <span class="kw">formatId</span><span class="kw">=</span><span class="st">"application/octet-stream"</span>)</pre></body></html></div>
<p>The <code>replaceMember</code> method updates the DataPackage <code>pkg</code>, replacing the data content of the DataObject with identifier <code>objId</code>, and updating the relevant system metadata slots such as <code>size</code> and <code>checksum</code>, to reflect the new contents of the DataObject.</p>
<p>In this example, the file <code>WeatherInf.txt</code> was mistakenly omitted from the original package upload, so add it now:</p>
<p>First, the identifier for the metadata DataObject that describes the package members will be retrieved from the DataPackage:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">metadataId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@formatId"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>)</pre></body></html></div>
<p>The <code>selectMember</code> method returns the identifier of any DataObject in the package with an R slot name specified in the parameter <code>name</code> that matches the value specified in the argument <code>value</code>. In this particular package, there is only one DataPackage that has <code>formatId</code> of <code>eml://ecoinformatics.org/eml-2.1.1</code>, so only that identifier is returned.</p>
<p>Note that the <code>getValue</code> method can be used to retrieve the values for DataObject slots, for example:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/datapack/man/getValue.html">getValue</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@formatId"</span>)</pre></body></html></div>
<p>An R named list is returned, with the names being the identifiers of each DataPackage in the DataPackage and the values being the slot value.</p>
<p>Next, add a new package member that was omitted from the original package:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">auxFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/WeatherInf.txt"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"dataone"</span>)
<span class="no">auxObj</span> <span class="kw">&lt;-</span> <span class="fu">new</span>(<span class="st">"DataObject"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"text/csv"</span>, <span class="kw">filename</span><span class="kw">=</span><span class="no">auxFile</span>)
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/addMember.html">addMember</a></span>(<span class="no">pkg</span>, <span class="no">auxObj</span>, <span class="no">metadataId</span>)</pre></body></html></div>
<p>The modified package can be reviewed before updating to DataONE:</p>
</div>
<div id="upload-the-modified-datapackage" class="section level3">
<h3 class="hasAnchor">
<a href="#upload-the-modified-datapackage" class="anchor"></a>4. Upload the modified DataPackage</h3>
<p>Now upload the modified package to DataONE. Each DataObject in the DataPackage will be inspected by <code>uploadDataPackage</code> and DataObjects that have been modified will be updated and DataObjects that have been added to the DataPackage will be uploaded.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">newPackageId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/uploadDataPackage.html">uploadDataPackage</a></span>(<span class="no">d1c</span>, <span class="no">pkg</span>, <span class="kw">public</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">quiet</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
</div>
</div>
<div id="updating-metadata-for-a-datapackage" class="section level2">
<h2 class="hasAnchor">
<a href="#updating-metadata-for-a-datapackage" class="anchor"></a>Updating Metadata For A DataPackage</h2>
<p>As DataPackage members are modified, the DataObject that holds the metadata that describes the package members may become outdated.</p>
<p>For example, it was shown above that a package member was updated to contain the file <code>Strix-occidentalis-obs.csv.zip</code> instead of <code>Strix-occidentalis-obs.csv</code>. After this change, the DataObject holding the EML metadata should be updated so that the EML element <code>objectName</code> for this dataset matched the new filename:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">metadataId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@formatId"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>)
<span class="no">nameXpath</span> <span class="kw">&lt;-</span> <span class="st">'//dataTable/physical/objectName[text()="Strix-occidentalis-obs.csv"]'</span>
<span class="no">newName</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="no">zipfile</span>)
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/updateMetadata.html">updateMetadata</a></span>(<span class="no">pkg</span>, <span class="no">metadataId</span>, <span class="kw">xpath</span><span class="kw">=</span><span class="no">nameXpath</span>, <span class="kw">replacement</span><span class="kw">=</span><span class="no">newName</span>)</pre></body></html></div>
<p>The <code>updateMetadata</code> method updates a DataObject containing XML, substituting the value located in the document specified with the <code>xpath</code> argument with the value provided in the <code>replacement</code> argument. In this example, the XML contained in the DataObject with identifier <code>metadataId</code> is an EML metadata document. The EML element <code>objectName</code> is updated with the value <code>Strix-occidentalis-obs.csv.zip</code>.</p>
<p>Note the the <code>xpath</code> argument uses the XPath query language, which is used to locate elements within an XML document.</p>
<p>For EML metadata, another element that may need to be updated, if it is present in the original EML file, is the distribution url. This element contains the link that can be used to download the file from DataONE, which includes the DataONE identifier for the object. Because the identifier value is set when the DataObject is created, the EML metadata is out of date and needs to be updated with the new identifier value.</p>
<p>In this example, the section of the metadata that describes the dataset <code>Strix-occidentalis-obs.csv.zip</code> will be updated.</p>
<p>A portion of the EML from our example looks like this:</p>
<pre><code>    &lt;dataTable&gt;
      &lt;entityName&gt;Strix Occidentalis&lt;/entityName&gt;
      &lt;entityDescription&gt;A data file that contains only observations of Strix occidentalis&lt;/entityDescription&gt;
      &lt;physical&gt;
        &lt;objectName&gt;Strix-occidentalis-obs.csv&lt;/objectName&gt;
        &lt;size unit="byte"&gt;6017&lt;/size&gt;
        &lt;dataFormat&gt;
          &lt;externallyDefinedFormat&gt;
            &lt;formatName&gt;text/csv&lt;/formatName&gt;
          &lt;/externallyDefinedFormat&gt;
        &lt;/dataFormat&gt;
        &lt;distribution id="1430343425153"&gt;
          &lt;online&gt;
            &lt;url function="download"&gt;&lt;/url&gt;
          &lt;/online&gt;
        &lt;/distribution&gt;
      &lt;/physical&gt;
      &lt;entityType&gt;Other&lt;/entityType&gt;
    &lt;/dataTable&gt;</code></pre>
<p>The following lines get the current identifier for the DataObject that contains the correct file, and uses this identifier value to construct a standard DataONE access URL, using the base URL of the DataONE coordinating node.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">objId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@fileName"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">'Strix-occidentalis-obs.csv.zip'</span>)
<span class="no">newURL</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"%s/%s/resolve/%s"</span>, <span class="no">d1c</span>@<span class="kw">cn</span>@<span class="kw">baseURL</span>, <span class="no">d1c</span>@<span class="kw">cn</span>@<span class="kw">APIversion</span>, <span class="no">objId</span>)
<span class="no">newURL</span></pre></body></html></div>
<p>The <code>selectMember</code> method checks slot specified in <code>name</code> argument, in this case <code>sysmeta@fileName</code>, of each <em>DataObject</em> in the <em>DataPackage</em> <code>pkg</code> and returns the identifier of any member that matches the specified value. This package has only one <em>DataObject</em> with the name <code>Strix-occidentalis-obs.csv.zip</code> so only one identifier is returned in <code>objId</code>.</p>
<p>Next, the metadata element for the distribution url will be updated in the <em>DataObject</em> that contains the EML metadata in the package <code>pkg</code></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">metadataId</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/selectMember.html">selectMember</a></span>(<span class="no">pkg</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"sysmeta@formatId"</span>, <span class="kw">value</span><span class="kw">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>)
<span class="no">xpathToURL</span> <span class="kw">&lt;-</span> <span class="st">"//dataTable/physical/distribution[../objectName/text()=\"OwlNightj.csv\"]/online/url"</span>
<span class="no">pkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datapack/man/updateMetadata.html">updateMetadata</a></span>(<span class="no">pkg</span>, <span class="kw">do</span><span class="kw">=</span><span class="no">metadataId</span>, <span class="kw">xpath</span><span class="kw">=</span><span class="no">xpathToURL</span>, <span class="kw">replacement</span><span class="kw">=</span><span class="no">newURL</span>)</pre></body></html></div>
<p>When the modified metadata file is updated to DataONE, a new identifier is required, as the modified metadata will replace the old one by created a new object in DataONE, and marking the old one as <code>obsoleted</code> by the new one. For this reason, the call to <code>updateMetadata</code> will assign a new identifier to the metadata <em>DataObject</em> in the DataPackage <code>pkg</code>, if necessary.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew B. Jones, Peter Slaughter, Rob Nahf, Carl Boettiger, Chris Jones, Jordan Read, Lauren Walker, Edmund Hart, Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
