<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uploading Datasets to DataONE • dataone</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Uploading Datasets to DataONE">
<meta property="og:description" content="dataone">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataone</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v01-dataone-overview.html">dataone Package Overview</a>
    </li>
    <li>
      <a href="../articles/v02-dataone-federation.html">DataONE Federation</a>
    </li>
    <li>
      <a href="../articles/v03-searching-dataone.html">Searching DataONE Data Holdings</a>
    </li>
    <li>
      <a href="../articles/v04-download-data.html">Downloading Data From DataONE</a>
    </li>
    <li>
      <a href="../articles/v05-upload-data.html">Uploading Datasets to DataONE</a>
    </li>
    <li>
      <a href="../articles/v06-update-package.html">Updating Datasets on DataONE</a>
    </li>
    <li>
      <a href="../articles/v07-known-issues.html">Known Issues</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DataONEorg/rdataone/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v05-upload-data_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Uploading Datasets to DataONE</h1>
            
            <h4 class="date">2021-02-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DataONEorg/rdataone/blob/master/vignettes/v05-upload-data.Rmd"><code>vignettes/v05-upload-data.Rmd</code></a></small>
      <div class="hidden name"><code>v05-upload-data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This document describes how to use the <em>dataone</em> R package to upload data to DataONE, and how to perform maintenance operations on the data after upload.</p>
<p>The <em>dataone</em> R package provides methods to enable R scripts to interact with DataONE Coordinating Nodes (CN) and Member Nodes (MN), to search for, download, upload and update data and metadata. The <em>dataone</em> R package takes care of the details of calling the corresponding DataONE web service on a DataONE node. For example, the <em>dataone</em> <code>createObject</code> R method calls the DataONE web service <a href="https://purl.dataone.org/architecture/apis/MN_APIs.html#MNStorage.create">MNStorage.create()</a> that uploads a dataset to a DataONE MN.</p>
<p>Before uploading any data to a DataONE MN, it is necessary to obtain a DataONE user identity that will be provided with each request to upload or update data. The method that DataONE uses to achieve this is known as <em>user identity authentication</em>, and requires that an <em>authentication token</em>, which is a character string, be provided during upload. The process to obtain this token is described in the <em>DataONE Federation</em> vignette, in the section <strong>DataONE User Authentication With Tokens</strong>, which is viewable with the R command <code>vignette("dataone-overview")</code>. (Note: DataONE originally used X.509 certificates for authentication, which are still supported.)</p>
</div>
<div id="uploading-a-package-using-uploaddatapackage" class="section level2">
<h2 class="hasAnchor">
<a href="#uploading-a-package-using-uploaddatapackage" class="anchor"></a>Uploading A Package Using <code>uploadDataPackage</code>
</h2>
<p>Datasets and metadata can be uploaded individually or as a collection. Such a collection, whether contained in local R objects or existing on a DataONE repository, will be informally referred to as a <code>package</code> or ‘data package’. Figure 1. is a diagram of a typical DataONE package showing a metadata file that describes, or <code>documents</code> the data granules that the package contains.</p>
<p><img src="https://raw.githubusercontent.com/DataONEorg/rdataone/main/vignettes/package-diagram.png"></p>
<p>The steps necessary to to prepare and upload a package to DataONE using the <code>uploadDataPackage</code> method will be shown. A complete script that uses these steps is shown here, with detailed explanations of the steps following.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DataONEorg/rdataone">dataone</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/datapack/">datapack</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/uuid">uuid</a></span><span class="op">)</span>

<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataPackage"</span><span class="op">)</span>

<span class="va">emlFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/strix-pacific-northwest.xml"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">metadataObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>, filename<span class="op">=</span><span class="va">emlFile</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">metadataObj</span><span class="op">)</span>

<span class="va">sourceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/OwlNightj.csv"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">sourceObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"text/csv"</span>, filename<span class="op">=</span><span class="va">sourceData</span><span class="op">)</span> 
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">sourceObj</span>, <span class="va">metadataObj</span><span class="op">)</span>

<span class="va">progFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/filterObs.R"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">progObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"application/R"</span>, filename<span class="op">=</span><span class="va">progFile</span>, mediaType<span class="op">=</span><span class="st">"text/x-rsrc"</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">progObj</span>, <span class="va">metadataObj</span><span class="op">)</span>

<span class="va">outputData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Strix-occidentalis-obs.csv"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">outputObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"text/csv"</span>, filename<span class="op">=</span><span class="va">outputData</span><span class="op">)</span> 
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">outputObj</span>, <span class="va">metadataObj</span><span class="op">)</span>

<span class="va">myAccessRules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>subject<span class="op">=</span><span class="st">"https://orcid.org/0000-0002-2192-403X"</span>, permission<span class="op">=</span><span class="st">"changePermission"</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/D1Client.html">D1Client</a></span><span class="op">(</span><span class="st">"STAGING"</span>, <span class="st">"urn:node:mnStageUCSB2"</span><span class="op">)</span>
<span class="va">packageId</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uploadDataPackage.html">uploadDataPackage</a></span><span class="op">(</span><span class="va">d1c</span>, <span class="va">dp</span>, public<span class="op">=</span><span class="cn">TRUE</span>, accessRules<span class="op">=</span><span class="va">myAccessRules</span>, quiet<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>This particular package contains the R script <code>filterObs.R</code>, the input file <code>OwlNightj.csv</code> that was read by the script and the output file <code>Strix-occidentalis-obs.csv</code> that was created by the R script, which was run at a previous time.</p>
<p>The following sections describe each line of the above script in detail.</p>
<div id="create-a-datapackage-object-" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-datapackage-object-" class="anchor"></a>1. Create a DataPackage object.</h3>
<p>In order to use <code>uploadDataPackage</code>, it is necessary to prepare an R <em>DataPackage</em> object which is a container for the set of files that will be included in the package. The following commands load the required libraries and creates an empty DataPackage object that will be added to later:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DataONEorg/rdataone">dataone</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/datapack/">datapack</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/uuid">uuid</a></span><span class="op">)</span>

<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataPackage"</span><span class="op">)</span></code></pre></div>
<p>When using the <code>uploadDataPackage</code> method, data structures that are required by DataONE are created, configured and uploaded automatically with the package. These data structures include a <a href="https://purl.dataone.org/architecture/design/DataPackage.html#generating-resource-maps">ResourceMap</a> that details the contents of the package, and SystemMetadata objects that contain DataONE system information for each of the science datasets and associated science metadata.</p>
<p>A <code>dataone</code> <em>DataObject</em> is a container that holds both the data bytes and the system information for a metadata file, data or other type of file. A DataObject is created for each file that will be included in a DataPackage.</p>
</div>
<div id="prepare-a-metadata-file-that-will-describe-the-files-in-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-a-metadata-file-that-will-describe-the-files-in-the-package" class="anchor"></a>2. Prepare a metadata file that will describe the files in the package</h3>
<p>The next step is to prepare a metadata file that will describe the science datasets and other files in the package. The most common metadata format used in the DataONE network is the <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/index.html">Ecological Metadata Langauge</a> (EML). Other supported formats include FGDC, ISO 19115 and others. Additional information about EML is available at <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/index.html" class="uri">https://knb.ecoinformatics.org/#external//emlparser/docs/index.html</a>.</p>
<p>Detailed directions regarding authoring metadata documents are outside the scope of this document.</p>
<p>DataONE requires that any file uploaded to a member node have a unique identifier associated with it.</p>
<p>When a DataObject is created, a unique identifier is generated for the DataObject if one is not specified using the <code>id</code> parameter. This automatically generated identifier has the format “<a href="urn:uuid" class="uri">urn:uuid</a>:<a unique string>”, for example “</a><a href="urn:uuid:c3443142-6260-4ea5-aaa1-1114981e04ad" class="uri">urn:uuid:c3443142-6260-4ea5-aaa1-1114981e04ad</a>”.</p>
<p>The following commands create the DataObject for the science metadata, using an automatically generated identifier:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">emlFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/strix-pacific-northwest.xml"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">metadataObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>, filename<span class="op">=</span><span class="va">emlFile</span><span class="op">)</span></code></pre></div>
<p>Now add the metadata object to the DataPackage:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">metadataObj</span><span class="op">)</span></code></pre></div>
<p>Files are considered members of a package when they are enumerated and described by a metadata file, and a relationship between the metadata and data object is explicitly stated.</p>
<p>DataONE (and the <code>dataone</code> R package) has adopted the package guidelines detailed by the <a href="https://purl.dataone.org/architecture/design/DataPackage.html">DataONE package</a> implementation. In this specification, the relationship that links a metadata object and a science object is CiTO (Citation Typing Ontology) <em>documents</em>.</p>
<p>This relationship between the science metadata and data objects will be added to the DataPackage automatically for each data object as it is added to the DataPackage, if the metadata object is first added, then referenced as the DataObjects are added.</p>
<p>As the metadata object has already been added, it can be referenced as each DataObject is added.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">sourceObj</span>, <span class="va">metadataObj</span><span class="op">)</span></code></pre></div>
<p>Since <code>metadataObj</code> is included as the third argument here, the CiTO <em>documents</em> relationship will automatically be added between <code>metadataObj</code> and <code>sourceObj</code>.</p>
<p>Alternatively, this relationship between the metadata and science objects can be made explicitly using the <code><a href="https://docs.ropensci.org/datapack/reference/insertRelationship.html">insertRelationship()</a></code> method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">metadataObj</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">sourceObj</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/insertRelationship.html">insertRelationship</a></span><span class="op">(</span><span class="va">dp</span>, <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/getIdentifier.html">getIdentifier</a></span><span class="op">(</span><span class="va">metadataObj</span><span class="op">)</span>, <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/getIdentifier.html">getIdentifier</a></span><span class="op">(</span><span class="va">sourceObj</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that the relationship type, using the <code><a href="https://docs.ropensci.org/datapack/reference/insertRelationship.html">insertRelationship()</a></code> <code>predicate</code> argument does not have to be specified in this case, as the CiTO <em>documents</em> relationship is the default value for <code>insertRelationship</code>.</p>
</div>
<div id="create-and-add-a-dataobject-for-each-data-file" class="section level3">
<h3 class="hasAnchor">
<a href="#create-and-add-a-dataobject-for-each-data-file" class="anchor"></a>3. Create and add a DataObject for each data file</h3>
<p>A DataObject must be created for each metadata file, data file or any other type of file that will be included in the package.</p>
<p>A <code>dataone</code> <em>SystemMetadata</em> R object will be created automatically and stored in each DataObject. The information from the <em>SystemMetadata</em> R object will be used by DataONE to maintain low level information about the dataset, such as the access policy, the user identity of the <em>rightsholder</em> (the user identity that can modify access the dataset), which Member Nodes it can be replicated to, etc.</p>
<p>The example below creates a DataObject for a science dataset:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sourceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/OwlNightj.csv"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">sourceObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"text/csv"</span>, filename<span class="op">=</span><span class="va">sourceData</span><span class="op">)</span> 
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">sourceObj</span>, <span class="va">metadataObj</span><span class="op">)</span></code></pre></div>
<p>An optional <em>user</em> argument can be specified when creating a DataObject, which will be used to set the DataONE <em>submitter</em> and <em>rightsholder</em> of the dataset when it is uploaded. The rightsholder is granted all access privileges to the object.</p>
<p>If <em>user</em> is not specified for a <em>DataObject</em>, then the submitter and rightsholder for an object will automatically be set, when the object is uploaded to DataONE, to the DataONE user that created the authentication token or X.509 certificate.</p>
<p>Now DataObjects for an R script and for a file created by the R script will be created:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">progFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/filterObs.R"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">progObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"application/R"</span>, filename<span class="op">=</span><span class="va">progFile</span>, mediaType<span class="op">=</span><span class="st">"text/x-rsrc"</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">progObj</span>, mo<span class="op">=</span><span class="va">metadataObj</span><span class="op">)</span>

<span class="va">outputData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Strix-occidentalis-obs.csv"</span>, package<span class="op">=</span><span class="st">"dataone"</span><span class="op">)</span>
<span class="va">outputObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, format<span class="op">=</span><span class="st">"text/csv"</span>, filename<span class="op">=</span><span class="va">outputData</span><span class="op">)</span> 
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">outputObj</span>, mo<span class="op">=</span><span class="va">metadataObj</span><span class="op">)</span></code></pre></div>
<p><em>Important Note</em>: files previously uploaded to DataONE can be added to the DataPackage, for more information see the section “Adding Existing DataONE Files To A Package”.</p>
</div>
<div id="determine-what-access-your-data-and-metadata-should-have" class="section level3">
<h3 class="hasAnchor">
<a href="#determine-what-access-your-data-and-metadata-should-have" class="anchor"></a>4. Determine what access your data and metadata should have</h3>
<p>DataONE provides a mechanism that allows data submitters to control access to their data.</p>
<p>The levels of access available to objects in DataONE are “read”, “write”, and “changePermission”.</p>
<p>The “read” permission allows a user the ability to view the content of a DataONE object. The “write” permission allows a user the ability to change the content of an object via update services. The “changePermission” permission allows the ability to change the access policy for an object and includes both read and write permissions.</p>
<p>The access rules that are added to DataObjects in a DataPackage will determine the access that is granted to users accessing the package after it is uploaded to DataONE.</p>
<p>Each of these permissions can be granted to a single user, a group of users, or the special <em>public</em> user which means all users.</p>
<p>Each object in DataONE can have one or more access rules that control the access of that object. The complete set of access rules for an object is referred to as its <em>access policy</em>.</p>
<p>Access rules can be added to each <em>DataObject</em> individually after it has been created.</p>
<p>Alternatively, access rules can be specified for all package members when a package is uploaded using <code>uploadDataPackage</code>. This method is shown at the end of this section.</p>
<p>To grant read permission to all users:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sourceObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/setPublicAccess.html">setPublicAccess</a></span><span class="op">(</span><span class="va">sourceObj</span><span class="op">)</span></code></pre></div>
<p>Individual access rules to be added for a DataONE user identity can also be added to the access policy.</p>
<p>Access rules are added to a <em>DataObject</em> using the <code>addAccessRule</code> method. The following access rule will grant the user with the ORCID <code>https://orcid.org/0000-0002-2192-403X</code> <code>changePermission</code> access to the dataset:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myAccessRules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>subject<span class="op">=</span><span class="st">"https://orcid.org/0000-0002-2192-403X"</span>, permission<span class="op">=</span><span class="st">"changePermission"</span><span class="op">)</span> 
<span class="va">sourceObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addAccessRule.html">addAccessRule</a></span><span class="op">(</span><span class="va">sourceObj</span>, <span class="va">myAccessRules</span><span class="op">)</span></code></pre></div>
<p>DataONE user identities and user authentication are described in section <em>DataONE User Authentication</em> in the vignette <em>dataone-overview</em> (to view this vignette, type this command in the R console: <code>vignette("dataone-overview")</code>)</p>
</div>
<div id="upload-the-datapackage" class="section level3">
<h3 class="hasAnchor">
<a href="#upload-the-datapackage" class="anchor"></a>5. Upload the DataPackage</h3>
<p>When all DataObjects have been added to the DataPackage, call the <code>uploadDataPackage</code> method to upload the entire DataPackage.</p>
<p>As mentioned previous, as an alternative to adding access rules to each DataObject individually before adding it to the DataPackage, the access rules can be specified once when the package is uploaded to DataONE. For example, to add public access to every object in the package, and add the custom access rule show above, the <code>public</code> and <code>accessRules</code> arguments are used when calling <code>updateDataPackage</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/D1Client.html">D1Client</a></span><span class="op">(</span><span class="st">"STAGING"</span>, <span class="st">"urn:node:mnStageUCSB2"</span><span class="op">)</span>
<span class="va">packageId</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uploadDataPackage.html">uploadDataPackage</a></span><span class="op">(</span><span class="va">d1c</span>, <span class="va">dp</span>, public<span class="op">=</span><span class="cn">TRUE</span>, accessRules<span class="op">=</span><span class="va">myAccessRules</span>, quiet<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Uploaded package with identifier: %s"</span>, <span class="va">packageId</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>(Note that the example uses a DataONE test environment <em>STAGING</em>, and not the production environment.)</p>
<p>After <em>uploadDataPackage</em> has been called successfully, the package can be viewed on the member node, searched for using the DataONE search facility. Note that if objects in DataONE are not publicly readable, and the authenticated user performing the search isn’t granted access in an object’s access policy, then the objects will not be viewable or discoverable via the search facility for that user.</p>
</div>
</div>
<div id="using-a-digital-object-identifier-with-a-package-" class="section level2">
<h2 class="hasAnchor">
<a href="#using-a-digital-object-identifier-with-a-package-" class="anchor"></a>Using a Digital Object Identifier with a package.</h2>
<p>A Digital Object Identifier (DOI) may be assigned to the metadata <em>DataObject</em>, using the <em>generateIdentifier</em> method:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CNode.html">CNode</a></span><span class="op">(</span><span class="st">"STAGING"</span><span class="op">)</span>
<span class="va">mn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMNode.html">getMNode</a></span><span class="op">(</span><span class="va">cn</span>, <span class="st">"urn:node:mnStageUCSB2"</span><span class="op">)</span>
<span class="va">doi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateIdentifier.html">generateIdentifier</a></span><span class="op">(</span><span class="va">mn</span>, <span class="st">"DOI"</span><span class="op">)</span>
<span class="va">metadataObj</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"DataObject"</span>, id<span class="op">=</span><span class="va">doi</span>, format<span class="op">=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>, file<span class="op">=</span><span class="va">sampleEML</span><span class="op">)</span></code></pre></div>
<p>The <code>generateIdentifier</code> method requests that the DataONE MN generate a properly formatted DOI.</p>
</div>
<div id="adding-existing-dataone-files-to-a-package" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-existing-dataone-files-to-a-package" class="anchor"></a>Adding Existing DataONE Files To A Package</h2>
<p>Files that have previously been uploaded to DataONE can be added to a new DataPackage. New DataObjects can be created by downloading an existing DataONE item:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDataObject.html">getDataObject</a></span><span class="op">(</span><span class="va">d1c</span>, id<span class="op">=</span><span class="st">"urn:uuid:1234"</span>, lazyLoad<span class="op">=</span><span class="cn">T</span>, limit<span class="op">=</span><span class="st">"1TB"</span><span class="op">)</span>
<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addMember.html">addMember</a></span><span class="op">(</span><span class="va">dp</span>, <span class="va">dataObj</span>, mo<span class="op">=</span><span class="va">metadatqObj</span><span class="op">)</span></code></pre></div>
<p>The above example creates a new DataObject by downloading the existing item from DataONE that has the identifier “<a href="urn:uuid:1234" class="uri">urn:uuid:1234</a>” and using the ’d1c` variable previously defined. This DataObject is then added to the package. In this example, the optional “lazyLoad” and “limit” parameters are used. These parameters cause <em>getDataObject</em> to only download the system information (i.e. access rules, format information) and not the data bytes associated with this identifier. Using these parameters can be helpful if the file associated with this identifier is very large. For the purpose of adding this DataONE identifier to a DataPackage, the data bytes are not required.</p>
<p>Reusing DataONE items this way results in one copy of the item existing in DataONE but being included in multiple DataONE packages.</p>
</div>
<div id="uploading-individual-data-and-metadata-files" class="section level2">
<h2 class="hasAnchor">
<a href="#uploading-individual-data-and-metadata-files" class="anchor"></a>Uploading Individual Data And Metadata Files</h2>
<p>A single data or metadata file can be uploaded to a DataONE MN using the <em>createObject</em> method. When uploading a single file using this method, additional information must be supplied to DataONE that controls how DataONE interacts with the uploaded file. This additional information is stored in DataONE as a <em>system metadata</em> object and contains information such as who can access or update the file, how many copies of the file should be maintained, whether the file has been superseded by another object, etc. The system metadata information that will be uploaded to DataONE is collected and stored in an R object type <em>datapack::SystemMetadata</em>, as shown below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dirk.eddelbuettel.com/code/digest.html">digest</a></span><span class="op">)</span>
<span class="co"># Create a system metadata object for a data file. </span>
<span class="co"># Just for demonstration purposes, create a temporary data file.</span>
<span class="va">testdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,y<span class="op">=</span><span class="fl">11</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">csvfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".csv"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">testdf</span>, <span class="va">csvfile</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">format</span> <span class="op">&lt;-</span> <span class="st">"text/csv"</span>
<span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="va">csvfile</span><span class="op">)</span><span class="op">$</span><span class="va">size</span>
<span class="va">sha256</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html">digest</a></span><span class="op">(</span><span class="va">csvfile</span>, algo<span class="op">=</span><span class="st">"sha256"</span>, serialize<span class="op">=</span><span class="cn">FALSE</span>, file<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Generate a unique identifier for the dataset</span>
<span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"urn:uuid:%s"</span>, <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"SystemMetadata"</span>, identifier<span class="op">=</span><span class="va">pid</span>, formatId<span class="op">=</span><span class="va">format</span>, size<span class="op">=</span><span class="va">size</span>, checksum<span class="op">=</span><span class="va">sha256</span><span class="op">)</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addAccessRule.html">addAccessRule</a></span><span class="op">(</span><span class="va">sysmeta</span>, <span class="st">"public"</span>, <span class="st">"read"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, the system metadata could have been created with a <em>seriesId</em>. The <em>seriesId</em> is explained in the <em>dataone_overview</em> vignette. The following example shows the creation of a <em>SystemMetadata</em> object using the optional <em>seriesId</em>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a system metadata object for a data file. </span>
<span class="co"># Just for demonstration purposes, create a temporary data file.</span>
<span class="va">testdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,y<span class="op">=</span><span class="fl">11</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">csvfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".csv"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">testdf</span>, <span class="va">csvfile</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">format</span> <span class="op">&lt;-</span> <span class="st">"text/csv"</span>
<span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="va">csvfile</span><span class="op">)</span><span class="op">$</span><span class="va">size</span>
<span class="va">sha256</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html">digest</a></span><span class="op">(</span><span class="va">csvfile</span>, algo<span class="op">=</span><span class="st">"sha256"</span>, serialize<span class="op">=</span><span class="cn">FALSE</span>, file<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Generate a unique identifier for the dataset</span>
<span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"urn:uuid:%s"</span>, <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># The seriesId can be any unique character string.</span>
<span class="va">seriesId</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"urn:uuid:%s"</span>, <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"SystemMetadata"</span>, identifier<span class="op">=</span><span class="va">pid</span>, formatId<span class="op">=</span><span class="va">format</span>, size<span class="op">=</span><span class="va">size</span>, checksum<span class="op">=</span><span class="va">sha256</span>,  seriesId<span class="op">=</span><span class="va">seriesId</span><span class="op">)</span></code></pre></div>
<p>A unique identifier must be specified for each system metadata, whether or not a seriesId is used.</p>
<p>The dataset can now be uploaded to DataONE with the associated system metadata:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CNode.html">CNode</a></span><span class="op">(</span><span class="st">"STAGING"</span><span class="op">)</span>
<span class="va">mn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMNode.html">getMNode</a></span><span class="op">(</span><span class="va">cn</span>, <span class="st">"urn:node:mnStageUCSB2"</span><span class="op">)</span>
<span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createObject.html">createObject</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">pid</span>, <span class="va">csvfile</span>, <span class="va">sysmeta</span><span class="op">)</span></code></pre></div>
<p>Note that for this example, the DataONE test environment <em>STAGING</em> is used, and not the production environment.</p>
</div>
<div id="maintaining-uploaded-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#maintaining-uploaded-datasets" class="anchor"></a>Maintaining Uploaded Datasets</h2>
<p>After data has been uploaded to DataONE, maintenance operations can be performed on these objects using the methods described in the following sections.</p>
<div id="update-the-dataone-system-metadata-for-an-object-mnode-updatesystemmetadata" class="section level3">
<h3 class="hasAnchor">
<a href="#update-the-dataone-system-metadata-for-an-object-mnode-updatesystemmetadata" class="anchor"></a>Update the DataONE system metadata for an object (MNode: updateSystemMetadata)</h3>
<p>The system metadata can be updated for an object in DataONE without updating the data bytes of the object itself. For example, if an object was only readable by the data submitter, the access policy for an object can be updated to enable public access. System metadata is updated for an object using the <em>updateSystemMetadata</em> method:</p>
<p>The following example first downloads the current system metadata for the pid from the previous example, then updates the access policy that will be applied to the object and uploads the new system metadata to DataONE so that the changes will be applied:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CNode.html">CNode</a></span><span class="op">(</span><span class="st">"STAGING"</span><span class="op">)</span>
<span class="va">mn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMNode.html">getMNode</a></span><span class="op">(</span><span class="va">cn</span>, <span class="st">"urn:node:mnStageUCSB2"</span><span class="op">)</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSystemMetadata.html">getSystemMetadata</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">pid</span><span class="op">)</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datapack/reference/addAccessRule.html">addAccessRule</a></span><span class="op">(</span><span class="va">sysmeta</span>, <span class="st">"public"</span>, <span class="st">"read"</span><span class="op">)</span>
<span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateSystemMetadata.html">updateSystemMetadata</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">pid</span>, <span class="va">sysmeta</span><span class="op">)</span></code></pre></div>
<p>Note that updating an object in DataONE requires the proper access. For example, for the identifier shown above (<a href="urn:uuid:17d61d5a-061a-4778-9cdf-4e14751aaddc" class="uri">urn:uuid:17d61d5a-061a-4778-9cdf-4e14751aaddc</a>), only the DataONE user identity that is the <em>rightsholder</em>, or another user identity that has been granted write access by the rightsholder will be able to update the object on the DataONE member node. Running the previous example without the proper authentication will produce an error.</p>
</div>
<div id="replace-an-object-with-a-newer-version-mnode-updateobject" class="section level3">
<h3 class="hasAnchor">
<a href="#replace-an-object-with-a-newer-version-mnode-updateobject" class="anchor"></a>Replace an object with a newer version (MNode: updateObject)</h3>
<p>The <em>updateObject</em> updates an existing object by creating a new object identified by a new PID on the Member Node. The new object replaces and <em>obsoletes</em> the old object. An obsoleted object in DataONE does not appear in search results, however it is still available for download if the identifier is known.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Update object from previous example with a new version</span>
<span class="va">updateid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"urn:uuid:%s"</span>, <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">testdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,y<span class="op">=</span><span class="fl">11</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">csvfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".csv"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">testdf</span>, <span class="va">csvfile</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="va">csvfile</span><span class="op">)</span><span class="op">$</span><span class="va">size</span>
<span class="va">sha256</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html">digest</a></span><span class="op">(</span><span class="va">csvfile</span>, algo<span class="op">=</span><span class="st">"sha256"</span>, serialize<span class="op">=</span><span class="cn">FALSE</span>, file<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Start with the old object's sysmeta, then modify it to match</span>
<span class="co"># the new object. We could have also created a sysmeta from scratch.</span>
<span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSystemMetadata.html">getSystemMetadata</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">pid</span><span class="op">)</span>
<span class="va">sysmeta</span><span class="op">@</span><span class="va">identifier</span> <span class="op">&lt;-</span> <span class="va">updateid</span>
<span class="va">sysmeta</span><span class="op">@</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">size</span>
<span class="va">sysmeta</span><span class="op">@</span><span class="va">checksum</span> <span class="op">&lt;-</span> <span class="va">sha256</span>
<span class="va">sysmeta</span><span class="op">@</span><span class="va">obsoletes</span> <span class="op">&lt;-</span> <span class="va">pid</span>
<span class="co"># Now update the object on the member node.</span>
<span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateObject.html">updateObject</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">pid</span>, <span class="va">csvfile</span>, <span class="va">updateid</span>, <span class="va">sysmeta</span><span class="op">)</span>
<span class="co"># Get the new, updated sysmeta and check it to ensure that the update</span>
<span class="co"># worked, i.e. "obsoletes" is the old pid that was replaced by the update.</span>
<span class="va">updsysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSystemMetadata.html">getSystemMetadata</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">updateid</span><span class="op">)</span>
<span class="va">updsysmeta</span><span class="op">@</span><span class="va">obsoletes</span></code></pre></div>
<p>The Member Node will mark the object as being <em>obsolete</em> by setting a property in the system metadata on the object being replaced. An object marked as <em>obsolete</em> will not appear in search results, however, such an object is still available for download if the PID is known.</p>
</div>
<div id="remove-an-object-from-dataone-search" class="section level3">
<h3 class="hasAnchor">
<a href="#remove-an-object-from-dataone-search" class="anchor"></a>Remove an object from DataONE search</h3>
<p>An object can be removed from searches done with the DataONE search mechanism by calling the <em>archive</em> method with the PID of the object. This operation does not delete the object bytes, but instead updates the system metadata for the object to set the <em>archived</em> flag to true. The object can still be referenced with its PID and downloaded, but it will not appear in any search results.</p>
<p>Objects that are archived can not be updated using the <em>updateObject</em> method. Once an object is archived it cannot be un-archived.</p>
<p>The following statement archives the object that was just created in the previous example with the <em>updateObject</em> method.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/archive.html">archive</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">updateid</span><span class="op">)</span></code></pre></div>
<p>The following commands can be used to verify that the object was archived.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sysmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSystemMetadata.html">getSystemMetadata</a></span><span class="op">(</span><span class="va">mn</span>, <span class="va">updateid</span><span class="op">)</span>
<span class="va">sysmeta</span><span class="op">@</span><span class="va">archived</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew B. Jones, Peter Slaughter, Rob Nahf, Carl Boettiger, Chris Jones, Bryce Mecum, Jeanette Clark, Lauren Walker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
